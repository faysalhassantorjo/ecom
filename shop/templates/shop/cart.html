<!DOCTYPE html>
<html lang="en">
{% load static %}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Longg-লং</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Arvo:ital,wght@0,400;0,700;1,400;1,700&display=swap"
        rel="stylesheet">


    <link rel="stylesheet" href="{% static 'shop/css/cart.css' %}">

</head>

<body>
    {% include 'shop/components/simpleNav.html' %}

    <div class="container my-5">
        {% for item in order.order_items.all %}

        <div class="cart-item row">
            <div class="col-md-4">
                <img src="{{item.product.imageURL}}" height="100" width="100" style="border-radius: 10px;"
                    alt="Product 2">
                {% if item.customization_note %}
                <p style="font-size: .8rem;">{{item.customization_note}}</p>
                {% endif %}
            </div>

            <div class="col-md-4">
                <ul class="cart-item-details">
                    <li><strong> {{item.product.name}}</strong></li>
                    <li>Size: {{item.size}}</li>
                    {% if item.is_stitched %}
                    <li> {{item.product.price_}}</li>
                    {% else %}
                    <li>{{item.product.unstitched_price}}</li>
                    {% endif %}

                    <li>
                        {% if item.is_stitched %}

                        {% else %}
                        <span
                            style="background-color: #f74f06; color: #121212; border-radius: 2px; padding: 3px; font-size: 10px;">unstitched</span>
                        {% endif %}
                    </li>
                </ul>
                <!-- Add-on Product -->
                <ul class="cart-item-details add-on-product">
                    {% for add_on in item.addon.all %}

                    <li><em>+ Add-on: {{ add_on.name }} qty({{item.quantity}}) size: {{add_on.size}} (<i
                                class="fa-solid fa-bangladeshi-taka-sign"></i>{{add_on.price}})</em></li>
                    {% endfor %}
                </ul>
            </div>
            <div class="col-md-3 d-flex flex-column justify-content-between">
                <div class="qty d-flex justify-content-center">

                    <form method="post" action="{% url 'update_item' %}">
                        {% csrf_token %}
                        <input type="text" name="size" value="{{item.size}}" hidden>
                        <input type="text" name="action" value="remove {{ item.product.slug }}" hidden>
                        <input type="text" name="from" value="cart" hidden>
                        <input type="text" name="unstitched" value="{{item.is_stitched}}" hidden>
                        <input type="text" name="item_id" , hidden value="{{item.id}}">

                        <button type="submit" class="btn btn-outline-light">
                            <i class="fa fa-minus"></i>
                        </button>
                    </form>
                    <span class="mx-2">{{item.quantity}}</span>
                    <form method="post" action="{% url 'update_item' %}">
                        {% csrf_token %}
                        <input type="text" name="size" value="{{item.size}}" hidden>
                        <input type="text" name="action" value="add {{ item.product.slug }}" hidden>
                        <input type="text" name="from" value="cart" hidden>
                        <input type="text" name="unstitched" value="{{item.is_stitched}}" hidden>

                        <input type="text" name="item_id" , hidden value="{{item.id}}">

                        <button type="submit" class="btn btn-outline-light">
                            <i class="fa fa-plus"></i>
                        </button>
                    </form>
                </div>
                <br>
                <p><strong>Total: {{item.item_total}}</strong></p>
            </div>

            <div class="col-md-1">
                <form method="post" action="{% url 'update_item' %}">
                    {% csrf_token %}
                    <input type="text" name="size" value="{{item.size}}" hidden>
                    <input type="text" name="action" value="delete {{ item.product.slug }}" hidden>
                    <input type="text" name="from" value="cart" hidden>
                    <input type="text" name="unstitched" value="{{item.is_stitched}}" hidden>
                    <input type="text" name="customization_note" value="{{item.customization_note}}" hidden>
                    <input type="text" name="item_id" , hidden value="{{item.id}}">

                    <button type="submit" class="btn btn-danger">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                </form>
            </div>
        </div>

        {% endfor %}

        {% if order.total %}

        <div>
            <p style="text-align: end; font-weight:lighter;">Sub Total - {{order.total}} </p>
        </div>

        {% if messages %}
        <div id="flash-messages">
            {% for message in messages %}
            <p style="color: #08e6ff; text-align: center;">{{ message }}</p>
            {% endfor %}
        </div>

        <script>
            setTimeout(() => {
                const msgBox = document.getElementById("flash-messages");
                if (msgBox) {
                    msgBox.style.display = "none";
                }
            }, 2000); // 2000 ms = 2 seconds
        </script>
        {% endif %}


        <!-- Cart Summary -->
        <div class="row justify-content-between mt-5">
            <div class="col-md-6 col-12 mt-1">
                <!-- <div class="card">
                    {% if order.promo %}
                    <div class="card-body"
                        style="background: #f74f06;overflow: hidden; border: 1px dashed #ffffff; border-radius: 4px;">
                        <span class="promo-tag d-flex justify-content-center">
                            Promo Applied: {{ order.promo.code }} ({{ order.promo.promo_type.discount_percentage}}%)
                        </span>
                    </div>
                    {% else %}
                    <div class="card-body">

                        <a class="mb-2 text-light" href="{% url 'promo_code' %}">Student? <span
                                style="color: #bb86fc;">Get promo code</span>
                            {% if not request.user.is_authenticated %}
                            <span class="text-secondary" style="font-size: .8rem;">You need to log in First</span>
                            {% endif %}
                        </a>
                        <style>
                            input:focus {
                                border: none !important;
                                box-shadow: none !important;
                            }
                        </style>


                        <form id="promoForm" class="mb-3 mt-2 d-flex">
                            {% csrf_token %}
                            <input type="text" name="promo_code" id="promo_code"
                                value="{% if code %}{{ code }}{% endif %}" placeholder="Enter promo code"
                                class="form-control me-2" required>
                            <button type="submit" class="btn btn-dark">Apply</button>
                        </form>

                        <script>
                            document.getElementById("promoForm").addEventListener("submit", function (e) {
                                e.preventDefault(); // stop normal form submit

                                const promoCode = document.getElementById("promo_code").value;
                                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

                                fetch("{% url 'cart' %}", {
                                    method: "POST",
                                    headers: {
                                        "Content-Type": "application/x-www-form-urlencoded",
                                        "X-CSRFToken": csrfToken
                                    },
                                    body: new URLSearchParams({
                                        "promo_code": promoCode
                                    })
                                })
                                    .then(response => response.text())
                                    .then(data => {
                                        window.location.reload()
                                    })
                                    .catch(error => {
                                        console.error("Error:", error);
                                    });
                            });
                        </script>

                    </div>

                    {% endif %}
                </div> -->
            </div>

            <div class="col-md-6 col-12 mt-1">
                <style>
                    .card-body {
                        padding: 20px;
                        /* Adds padding inside the card */
                    }

                    .card-title {
                        font-size: 1.25rem;
                        /* Larger font size for title */
                        color: #ffffff;
                        /* White color for title */
                        margin-bottom: 15px;
                        /* Spacing below the title */
                    }

                    .cart-summary-list {
                        list-style: none;
                        /* Removes bullets */
                        padding: 0;
                        /* Removes default padding */
                        margin-bottom: 20px;
                        /* Adds space before the button */
                    }

                    .cart-summary-list li {
                        display: flex;
                        justify-content: space-between;
                        /* Aligns items and values */
                        margin-bottom: 10px;
                        /* Spacing between list items */
                        font-size: 1rem;
                        /* Font size for list items */
                    }

                    .cart-summary-list span {
                        font-weight: bold;
                        /* Makes values bold */
                    }

                    .btn-primary {
                        background-color: #6200ee;
                        /* Primary button color */
                        border-color: #6200ee;
                        /* Border color matches the background */
                    }

                    .btn-primary:hover {
                        background-color: #3700b3;
                        /* Darker shade on hover */
                        border-color: #3700b3;
                        /* Border color on hover */
                    }

                    .btn-secondary {
                        background-color: #333;
                        /* Darker color for disabled button */
                        border-color: #444;
                        /* Slightly lighter border */
                        color: #666;
                        /* Text color for disabled button */
                    }

                    .btn-secondary.disabled {
                        opacity: 0.7;
                        /* Reduced opacity for disabled state */
                        cursor: not-allowed;
                        /* Indicates the button is not clickable */
                    }
                </style>
                <div class="card">
                    <div class="card-body">
                        <h6 class="card-title">Cart Total</h6>
                        <ul class="cart-summary-list">
                            <li>Total Items <span>{{ order.total_items }}</span></li>
                            <li>Saves <span>{{ saves }} TK</span></li>
                            <li>Total <span>{{ order.get_total }} TK</span></li>
                        </ul>
                        {% if order.total_items %}
                        <a href="{% url 'location_choice' pk=order.id %}" class="btn btn-light">Proceed to
                            Checkout</a>
                        {% else %}
                        <a href="#" class="btn btn-dark disabled">Proceed to Checkout</a>
                        {% endif %}
                    </div>
                </div>

            </div>
        </div>
        {% endif %}
    </div>

    <!-- Bootstrap JS, Popper.js, and jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>

</html>