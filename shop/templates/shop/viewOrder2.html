<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Management Dashboard</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">

    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Protest+Guerrilla&family=Saira:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: "Montserrat", sans-serif;
        }
        .nav-pills .nav-link.active {
            background-color: #212529 !important;  /* Bootstrap dark color */
            color: white !important;
        }
        .nav-pills .nav-link {
            color: #212529;
            background-color: transparent;
        }


        @media print {
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<style>

</style>
<body class="bg-light">
    <!-- Header -->
    <div class="bg-dark text-white py-4 mb-4 no-print">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="h3 mb-0 fw-bold">
                        <i class="fas fa-clipboard-list me-3"></i>
                        Order Management Dashboard
                    </h1>
                </div>
                <div class="col-md-4 text-md-end mt-3 mt-md-0">
                    <a href="/" class="btn btn-outline-light">
                        <i class="fas fa-home me-2"></i>Home
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Navigation Tabs -->
        <div class="card shadow-sm mb-4 no-print">
            <div class="card-body p-2">
                <ul class="nav nav-pills nav-fill" id="ordersTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <a href="{% url 'viewOrder' %}" class="nav-link  {% if status == None %} active {% endif %}">
                            <i class="fas fa-clock me-2"></i>
                            Available Orders
                            {% if status == None %}
                            <span class="badge bg-success ms-2">{{shippingAddresss|length}}</span>
                            {% endif %}
                        </a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a href="{% url 'viewOrder' %}?status=confirmed"
                            class="nav-link {% if status == 'confirmed' %} active {% endif %}">
                            <i class="fas fa-check-circle me-2"></i>
                            Confirmed Orders
                            {% if status == 'confirmed' %}
                            <span class="badge bg-light text-dark ms-2">{{shippingAddresss|length}}</span>
                            {% endif %}
                        </a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a href="{% url 'viewOrder' %}?status=cancelled"
                            class="nav-link {% if status == 'cancelled' %} active {% endif %}">
                            <i class="fas fa-times-circle me-2"></i>
                            Cancelled Orders
                            {% if status == 'cancelled' %}
                            <span class="badge bg-danger ms-2">{{shippingAddresss|length}}</span>
                            {% endif %}
                        </a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" href="/admin/">
                            <i class="fas fa-cog me-2"></i>Admin Panel
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Orders Display -->
            <div class="tab-pane fade show active" id="orders" role="tabpanel">
                {% if not shippingAddresss %}
                <div class="card shadow-sm">
                    <div class="card-body text-center py-5">
                        <i class="fas fa-inbox display-1 text-muted mb-3"></i>
                        <h4 class="text-muted">No Orders Found</h4>
                        <p class="text-muted">There are no orders for the selected status.</p>
                    </div>
                </div>
                {% endif %}

                {% for shippingaddress in shippingAddresss %}
                <div class="card shadow-sm mb-4" id="{{ shippingaddress.order.id }}">
                    <!-- Order Header -->
                    <div class="card-header bg-light">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <h5 class="mb-0">
                                    Order <span class="badge bg-dark fs-6">#{{ shippingaddress.order.id }}</span>
                                </h5>
                            </div>
                            <div class="col-md-6 text-md-end">
                                <div class="text-muted">
                                    <i class="far fa-calendar-alt me-2"></i>
                                    {{shippingaddress.timestamp|date:"M d, Y H:i"}}
                                    <br><small>({{shippingaddress.timestamp|timesince}} ago)</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card-body">
                        <!-- Customer Information -->
                        <div class="alert alert-light border-start mb-4">
                            <!-- <h6 class="text-primary mb-3">
                                <i class="fas fa-user me-2"></i>Customer Information
                            </h6> -->
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div>
                                        <div class="fw-semibold fs-5">
                                            {{ shippingaddress.first_name }} {{ shippingaddress.last_name }}
                                            {% if shippingaddress.order.user %}
                                            <span class="badge bg-secondary ms-2 small">{{ shippingaddress.order.user}}</span>
                                            {% endif %}
                                        </div>
                                        <div class="text-muted small">{{ shippingaddress.email }}</div>
                                        <!-- <div class="mt-1">{{ shippingaddress.phon }}</div> -->

                                        <div class="mt-2">
                                            <div class="fw-semibold">Phone</div>
                                            <div class="text-muted small">{{ shippingaddress.phon }}</div>
                                        </div>

                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="fw-semibold">Address</div>
                                    <div class="text-muted small">{{ shippingaddress.address }}</div>

                                    {% if shippingaddress.address_note %}
                                    <div class="mt-2">
                                        <div class="fw-semibold">Note</div>
                                        <div class="text-muted small">{{ shippingaddress.address_note }}</div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>

                        </div>

                        <!-- Products Table -->
                        <div class="table-responsive mb-4">
                            <table class="table table-hover table-bordered">
                                <thead class="table-dark">
                                    <tr>
                                        <th class="text-center">Product</th>
                                        <th class="text-center">Details</th>
                                        <th class="text-center">Quantity</th>
                                        <th class="text-center">Size</th>
                                        <th class="text-center">Price</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for orderItem in shippingaddress.order.order_items.all %}
                                    <tr>
                                        <td class="text-center">
                                            <img src="{{ orderItem.product.imageURL }}" alt="product"
                                                class="img-fluid rounded"
                                                style="width: 80px; height: 80px; object-fit: cover;">
                                            {% if not orderItem.is_stitched %}
                                            <br><span class="badge bg-warning text-dark mt-1">Unstitched</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <strong>{{ orderItem.product.name }}</strong>
                                            {% if orderItem.customization_note %}
                                            <br><small class="text-muted">{{orderItem.customization_note}}</small>
                                            {% endif %}
                                        </td>
                                        <td class="text-center">{{ orderItem.quantity }}</td>
                                        <td class="text-center">{{ orderItem.size }}</td>
                                        <td class="text-center fw-bold">{{ orderItem.item_total }} TK</td>
                                    </tr>
                                    {% if orderItem.add_on_product.all %}
                                    <tr>
                                        <td colspan="5" class="p-0">
                                            <div class="bg-light p-3">
                                                <h6 class="text-muted mb-2">
                                                    <i class="fas fa-plus me-2"></i>Add-on Products:
                                                </h6>
                                                <div class="table-responsive">
                                                    <table class="table table-sm mb-0">
                                                        {% for add_on in orderItem.add_on_product.all %}
                                                        <tr>
                                                            <td>{{ add_on.name }}</td>
                                                            <td>{{ add_on.size }}</td>
                                                            <td class="fw-bold">{{ add_on.price }} TK</td>
                                                        </tr>
                                                        {% endfor %}
                                                    </table>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endif %}
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        <!-- Bill Summary and Status -->
                        <div class="row">
                            <div class="col-lg-6 mb-3">
                                <div class="card bg-dark bg-opacity-10 border-dark">
                                    <div class="card-header bg-dark text-white">
                                        <h6 class="mb-0">
                                            <i class="fas fa-receipt me-2"></i>Bill Summary
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Product Total:</span>
                                            <strong>{{shippingaddress.order.get_total}} TK</strong>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Delivery Charge:</span>
                                            <strong>{{shippingaddress.order.delivary_charge}} TK</strong>
                                        </div>
                                        <hr>
                                         
                                        <div class="d-flex justify-content-between">
                                            <span class="fw-bold fs-5">Total Amount:</span>
                                            <strong class="fs-5 text-dark">{{ shippingaddress.order.totalbill }}
                                                TK</strong>
                                        </div>
                                 
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-6 mb-3">
                                <div class="card no-print">
                                    <div class="card-header">
                                        <h6 class="mb-0">
                                            <i class="fas fa-tasks me-2"></i>Order Status
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        {% if shippingaddress.order.status == "Pending" %}
                                        <span class="badge bg-warning text-dark fs-6 mb-3">
                                            <i class="fas fa-clock me-1"></i>{{shippingaddress.order.status}}
                                        </span>
                                        {% elif shippingaddress.order.status == "Confirmed" %}
                                        <span class="badge bg-success fs-6 mb-3">
                                            <i class="fas fa-check-circle me-1"></i>{{shippingaddress.order.status}}
                                        </span>
                                        {% elif shippingaddress.order.status == "Cancelled" %}
                                        <span class="badge bg-danger fs-6 mb-3">
                                            <i class="fas fa-times-circle me-1"></i>{{shippingaddress.order.status}}
                                        </span>
                                        {% endif %}

                                        <div class="dropdown d-grid">
                                            <form method="POST" action="{% url 'order_status' %}">
                                                {% csrf_token %}
                                                <input type="hidden" name="order-id"
                                                    value="{{shippingaddress.order.id}}">

                                                <button class="btn btn-outline-info dropdown-toggle btn-sm" type="button"
                                                    data-bs-toggle="dropdown">
                                                    <i class="fas fa-edit me-2"></i>Change Status
                                                </button>

                                                <ul class="dropdown-menu w-100">
                                                    <li>
                                                        <button class="dropdown-item" type="submit" name="status"
                                                            value="Pending">
                                                            <i class="fas fa-clock text-warning me-2"></i>Pending
                                                        </button>
                                                    </li>
                                                    <li>
                                                        <button class="dropdown-item" type="submit" name="status"
                                                            value="Confirmed">
                                                            <i
                                                                class="fas fa-check-circle text-success me-2"></i>Confirmed
                                                        </button>
                                                    </li>
                                                    <li>
                                                        <button class="dropdown-item" type="submit" name="status"
                                                            value="Cancelled">
                                                            <i
                                                                class="fas fa-times-circle text-danger me-2"></i>Cancelled
                                                        </button>
                                                    </li>
                                                </ul>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Seen By Section -->
                        <!-- <div class="alert alert-secondary no-print">
                            <h6 class="alert-heading mb-2">
                                <i class="fas fa-eye me-2"></i>Viewed By:
                            </h6>
                            <div class="d-flex flex-wrap gap-2">
                                {% for user in shippingaddress.seen_by.all %}
                                <span class="badge bg-light text-dark border">
                                    <i class="fas fa-user-circle me-1"></i>{{ user.user.username }}
                                </span>
                                {% empty %}
                                <span class="badge bg-light text-muted border">
                                    <i class="fas fa-eye-slash me-1"></i>No views yet
                                </span>
                                {% endfor %}
                            </div>
                        </div> -->

                        <!-- Print Button -->
                        <div class="text-center no-print">
                            <button class="btn btn-secondary "
                                onclick="printDiv('{{ shippingaddress.order.id }}')">
                                <i class="fas fa-print me-2"></i>Print Order
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        function printDiv(divId) {
            let printContents = document.getElementById(divId).innerHTML;
            let originalContents = document.body.innerHTML;

            document.body.innerHTML = printContents;
            window.print();
            document.body.innerHTML = originalContents;

            // Force a page reload to restore functionality
            window.location.reload();
        }

        // Add loading state to status change buttons
        document.querySelectorAll('form[action*="order_status"] button[type="submit"]').forEach(button => {
            button.addEventListener('click', function () {
                this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Updating...';
                this.disabled = true;
            });
        });
    </script>
</body>

</html>


